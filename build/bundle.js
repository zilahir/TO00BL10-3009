(()=>{"use strict";(()=>{const e=document.getElementById("root"),t=document.getElementById("add-new-todo"),o=document.getElementById("new-todo-input"),n=document.getElementById("todo-container"),d=document.getElementById("new-todo-submit"),i=document.getElementById("todos"),a=document.getElementById("mark-all-done"),r=document.getElementById("delete-all"),s=document.getElementById("show-all"),l=document.getElementById("show-completed"),c=document.getElementById("show-active"),m="FILTER_ALL",u="FILTER_ACTIVE",w="FILTER_COMPLETED",g={rootAppElement:e,addNewTodoButton:t,newTodoInput:o,todoContainer:n,newTodoSubmitButton:d,todosContainer:i,markAllDoneButton:a,deleteAllTodosButton:r,filters:[{selector:s,logic:m,label:"all"},{selector:l,logic:w,label:"completed"},{selector:c,logic:u,label:"active"}]};function p(e){const t=g.todosContainer.querySelectorAll(`[data-id='${e}']`)[0],o=JSON.parse(window.localStorage.getItem("todos")),n=o.find((t=>t.id.toString()===e.toString()));t.setAttribute("data-isdone",!n.isDone);const d=o.map((t=>t.id.toString()===e.toString()?{...t,isDone:!t.isDone}:t));window.localStorage.setItem("todos",JSON.stringify(d))}class v{constructor({value:e,isDone:t=!1,id:o=(new Date).getTime(),createdAt:n=new Date}){this.value=e,this.isDone=t,this.id=o,this.createdAt=n}isValid(){return""!==this.value&&this.value.length>3}create(){!function(e){const t=function(){const e=window.localStorage.getItem("todos");return JSON.parse(e)}();if(Array.isArray(t)){const o=[...t,e];window.localStorage.setItem("todos",JSON.stringify(o))}}({value:this.value,isDone:this.isDone,id:this.id,createdAt:this.createdAt})}serialize(){return{value:this.value,isDone:this.isDone,id:this.id,createdAt:this.createdAt}}remove(){g.todosContainer.querySelectorAll(`[data-id='${this.id}']`)[0].remove()}render(){const e=document.createElement("div");e.setAttribute("data-id",this.id),e.setAttribute("data-isdone",this.isDone),e.setAttribute("class","one-todo");const t=document.createElement("span"),o=document.createElement("input");o.setAttribute("type","checkbox"),o.addEventListener("change",(e=>p(e.currentTarget.parentNode.parentNode.getAttribute("data-id")))),o.checked=this.isDone;const n=document.createElement("div"),d=document.createElement("div");d.setAttribute("class","one-todo-inner"),n.setAttribute("class","meta"),n.setAttribute("id","meta");const i=document.createElement("p");var a;i.innerHTML=(a=this.createdAt,new Date(a).toLocaleString("en-US",{weekday:"short",month:"long",day:"2-digit",year:"numeric"})),n.append(i),t.setAttribute("class","delete"),t.innerHTML="❌",t.addEventListener("click",(e=>function(e){const t=new CustomEvent("removeTodo",{detail:e});window.dispatchEvent(t)}(e.currentTarget.parentNode.parentNode.getAttribute("data-id"))));const r=document.createElement("p");r.innerHTML=this.value,d.append(r),d.append(o),d.append(t),e.append(d),e.append(n),g.todosContainer.append(e)}done(){p(this.id)}}function A(){const e=new v({value:g.newTodoInput.value});if(e.isValid()){const t=new CustomEvent("todoCreated",{detail:e.render()});window.dispatchEvent(t),e.create(),g.newTodoInput.value=""}else alert("not ok")}function h(e){const t=JSON.parse(window.localStorage.getItem("todos"));Array.isArray(t)&&t.map((t=>{const o=new v({id:t.id});return"done"===e?o.done():"delete"===e&&(window.localStorage.setItem("todos",JSON.stringify([])),o.remove())}))}g.newTodoSubmitButton.addEventListener("click",A),function(){const e=window.localStorage.getItem("todos");if(e)Array.isArray(JSON.parse(e))&&JSON.parse(e).map((e=>new v(e).render()));else{const e=new v({value:"Demo Todo"});e.render(),window.localStorage.setItem("todos",JSON.stringify([e.serialize()]))}window.addEventListener("todoCreated",(e=>function(e){return e.detail}(e))),window.addEventListener("removeTodo",(e=>function(e){const t=JSON.parse(window.localStorage.getItem("todos")).filter((t=>t.id.toString()!==e.detail));window.localStorage.setItem("todos",JSON.stringify(t)),new v({id:e.detail}).remove()}(e)))}(),g.markAllDoneButton.addEventListener("click",(()=>h("done"))),g.deleteAllTodosButton.addEventListener("click",(()=>h("delete"))),g.filters.map((e=>(e.selector.innerHTML=`Show ${e.label}`,e.selector.addEventListener("click",(()=>function(e,t){const o=Array.from(g.todoContainer.querySelectorAll("[data-isdone='false']")),n=Array.from(g.todoContainer.querySelectorAll("[data-isdone='true']")),d=Array.from(g.todoContainer.querySelectorAll(".one-todo")),i=Array.from(document.querySelectorAll(".btn-filter"));e===w?(o.map((e=>e.classList.add("hidden"))),n.map((e=>e.classList.remove("hidden")))):e===m?d.map((e=>e.classList.remove("hidden"))):e===u&&(n.map((e=>e.classList.add("hidden"))),o.map((e=>e.classList.remove("hidden")))),i.map((e=>e.getAttribute("id")===`show-${t}`?e.classList.add("active"):e.classList.remove("active")))}(e.logic,e.label))))))})()})();